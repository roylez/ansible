---

- name: sshd | disable password authentication
  lineinfile:
    dest: /etc/ssh/sshd_config
    line: "PasswordAuthentication no"
    regexp: ^PasswordAuthentication\s
  notify: restart_sshd

- name: sshd | enable pubkey authentication
  lineinfile:
    dest: /etc/ssh/sshd_config
    line: "PubkeyAuthentication yes"
    regexp: ^PubkeyAuthentication\s
  notify: restart_sshd

- name: sshd | disable root login
  lineinfile:
    dest: /etc/ssh/sshd_config
    line: "PermitRootLogin no"
    regexp: ^PermitRootLogin\s
  notify: restart_sshd

- name: sshd | allow only specified user
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: '^AllowUsers\s+'
    line: "AllowUsers {{ user }}"
  notify: restart_sshd

- name: sshd | change default port
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: '^Port\s+'
    line: "Port {{ ssh_port }}"
  notify: restart_sshd

