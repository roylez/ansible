bind_addr = "0.0.0.0"
data_dir = "/var/lib/nomad/"
name = "{{ ansible_nodename }}"

advertise {
  http = "{{ nomad_ip }}"
  rpc  = "{{ nomad_ip }}"
  serf = "{{ nomad_ip }}"
}

tls {
  http = true
  rpc  = true
  ca_file   = "/etc/nomad/ca.pem"
  cert_file = "/etc/nomad/nomad.pem"
  key_file  = "/etc/nomad/nomad-key.pem"
}

{% if nomad_is_server %}
server {
  enabled          = true
  bootstrap_expect = 3
  encrypt          = "{{ gossip_key }}"
  retry_join       = ["{{ nomad_server }}"]
}
{% endif %}

{% if nomad_is_client %}
client {
  enabled = true
  servers = ["{{ nomad_server }}"]
}
{% endif %}
